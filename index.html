<!DOCTYPE html>
<html>
  <head>
   <meta charset="UTF-8">
	<link rel="styesheet" href="default.css"/>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="translucent-black">
	<title>Joy & Pain Map</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.css' rel='stylesheet' />
	<link rel="stylesheet" href="http://js.arcgis.com/3.12/esri/css/esri.css">
	<link rel="stylesheet" href="http://js.arcgis.com/3.12/dijit/themes/nihilo/nihilo.css">
    <style>
      html, body, #mainWindow {
        font-family: sans-serif; 
        height: 100%; 
        width: 100%; 
      }
      html, body {
        margin: 0; 
        padding: 0;
      }
      #header {
        height: 80px; 
        overflow: auto;
        padding: 0.5em;
      }
	  #LocateButton {
      position: absolute;
      top: 95px;
      left: 20px;
      z-index: 50;
    }
	  #joy-pain-toggle-div {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 50;
    }
    
    #draw-tools-div span{
        display:block;
        padding: 1px 2px;
    }

.nihilo .dijitToggleButton .dijitButtonText{
    padding:4px 8px;
}

.nihilo .dijitToggleButton span {
    border-radius: 50px;
    background-color:#545454;
    color:white;
}
.nihilo .dijitToggleButton.dijitChecked span {
    background-color:#b18904;
}
    </style>
    
  </head>
  <body class="nihilo">

  <div id="mainWindow" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'headline'">
    <div id="map" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'">
        <div id="LocateButton"></div>
        <div id="joy-pain-toggle-div">
            <button data-dojo-type="dijit/form/ToggleButton" data-dojo-props="id:'joy-pain-toggle',onChange:function(val){if (val === false){this.set('label','PAIN')} else {this.set('label', 'JOY')}}, checked: true">
                JOY
            </button>
          <div id='draw-tools-div' data-dojo-type="dijit/layout/ContentPane">
            <button data-tool-name="FREEHAND_POLYLINE" data-dojo-type="dijit/form/Button">Draw a Line</button>
            <button data-tool-name="FREEHAND_POLYGON" data-dojo-type="dijit/form/Button">Create a Shape</button>
            <button data-tool-name="POINT" data-dojo-type="dijit/form/Button">Place a Circle</button>
          </div>
        </div>
	</div>
  </div>
	
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.js'></script>
	<script src="http://js.arcgis.com/3.12/"></script>
	<!--<script type="text/javascript" src="joypain.js"></script>-->
	<!-- <script>L.mapbox.accessToken = 'pk.eyJ1IjoianRyZWlua2UiLCJhIjoiaHF3VDZDMCJ9.vcDB3i-OmaAFJvOfpD6M_Q';
	var map = L.mapbox.map('map', 'jtreinke.l8090480')
	.setView([45, -93.00], 12);</script> -->
	<script>
      var map, joy_toolbar, pain_toolbar, symbol, geomTask, drawing;

      require([
        "esri/map", 
		    "esri/layers/WebTiledLayer",
        "esri/toolbars/draw",
        "esri/toolbars/edit",
        "esri/graphic",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleFillSymbol",
		"esri/dijit/LocateButton",
        "dojo/parser", "dijit/registry",
		
        "dijit/layout/BorderContainer", "dijit/layout/ContentPane", 
		"dijit/form/ToggleButton",
		"dojox/mobile/Switch",
		"dijit/form/HorizontalSlider",
		"dijit/form/HorizontalRule",
		"dijit/form/HorizontalRuleLabels",
        "dijit/form/Button", "dijit/WidgetSet", "dojo/domReady!"
      ], function(
        Map,
		WebTiledLayer,
		Draw,
    Edit, 
		Graphic, 
        SimpleMarkerSymbol, 
		SimpleLineSymbol, 
		SimpleFillSymbol,
		LocateButton,
        parser, 
		registry
      ) {
        parser.parse();
		
		var pencilMap = new WebTiledLayer("http://api.tiles.mapbox.com/v4/mmcfarlane83.lm01cdj5/${level}/${col}/${row}.png?access_token=pk.eyJ1IjoianRyZWlua2UiLCJhIjoiaHF3VDZDMCJ9.vcDB3i-OmaAFJvOfpD6M_Q");
		
		//var pencilMap = new WebTiledLayer("https://api.tiles.mapbox.com/v4/mmcfarlane83.lm01cdj5/${level}/${col}/${row}.png?access_token=pk.eyJ1IjoibW1jZmFybGFuZTgzIiwiYSI6InNQb1ZRQ0UifQ.WkcsZoP_C7A9i1FK7ScKUg#15/44.9683/-93.2567")//
		
        map = new Map("map", {
          center: [-93.17, 44.96],
		  zoom: 12
        });
		
		geoLocate = new LocateButton({
		  map: map
		}, "LocateButton");
		geoLocate.startup();
		
		map.on("load", createToolbars);
        map.addLayer(pencilMap);
		
  

        // loop through all dijits, connect onClick event
        // listeners for buttons to activate drawing tools
        registry.forEach(function(d) {
          // d is a reference to a dijit
          // could be a layout container or a button
          if ( d.declaredClass === "dijit.form.Button" ) {
            d.on("click", activateTool);
          }
        });

        function activateTool() {
          var tool = this.get("data-tool-name");
          var joy_pain_toggle_state = registry.byId("joy-pain-toggle").checked;
         
		  //trial switch statement
		  switch(joy_pain_toggle_state) {
			case true:
				joy_toolbar.activate(Draw[tool]);
				break;
			case false:
				pain_toolbar.activate(Draw[tool]);
				break;
		  }  
          map.hideZoomSlider();
        }

        function createToolbars() {
          //deleted one toolbar, renamed the other "draw_toolbar"
          joy_toolbar = new Draw(map);
		  pain_toolbar = new Draw(map);
          edit_toolbar = new Edit(map);
          
          var edit_listener = map.graphics.on("click", function(e){
            if (!drawing) {
              edit_toolbar.activate(Edit.MOVE, e.graphic);
            }
          });

          joy_toolbar.on("activate", function(e){
            console.log("joy: draw starting");
            drawing = true;
          });
          pain_toolbar.on("activate", function(e){
            console.log("pain: draw starting");
            drawing = true;
          });

          joy_toolbar.on("draw-end", function(e){
            console.log("joy: done drawing");
            drawing = false;
            addToMap(e,"joy");
          });
          pain_toolbar.on("draw-end", function(e){
            console.log("pain: done drawing");
            drawing = false;
            addToMap(e,"pain")
          });
        }

        function addToMap(evt,joy_or_pain) {
          var symbol;

          if (joy_or_pain === "joy"){
            joy_toolbar.deactivate();
          }
          else {
            pain_toolbar.deactivate();
          }
          
          map.showZoomSlider();

          switch (evt.geometry.type) {
            case "point":

              if (joy_or_pain ==="joy"){
                symbol =  new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE, 15,
                  new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
                  new esri.Color([177,137,4]), 1),
                  new esri.Color([177,137,4,0.25]));
              }

              else {
                symbol =  new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE, 15,
                  new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
                  new esri.Color([0,0,0]), 1),
                  new esri.Color([0,0,0,0.25]));
              }
              
              break;

            case "polyline":

              if (joy_or_pain ==="joy"){
                symbol = new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,
			            new esri.Color([177,137,4]), 3);
              } 

              else {
                symbol = new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,
                  new esri.Color([0,0,0]), 3);
              }
              break;

            default:
              if (joy_or_pain ==="joy"){
                symbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
        			    new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,
        				  new esri.Color([177,137,4]), 2),
        				  new esri.Color([177,137,4,0.25]));
              } 

              else {
                symbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                  new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,
                  new esri.Color([0,0,0]), 2),
                  new esri.Color([0,0,0,0.25]));
              }
              break;
          }
          var graphic = new Graphic(evt.geometry, symbol);
   
          map.graphics.add(graphic);
        }
		

      });
    </script>
	
  </body>
</html>